<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Seperation of Concern | DevBlog | E.S. Luper</title>
    <link rel="stylesheet" href="/css/style.css" />
    <link rel="stylesheet" href="/css/fonts.css" />
    
  </head>

  <body>
    <nav>
    <ul class="menu">
      
    </ul>
    <hr/>
    </nav>

<div class="article-meta">
<h1><span class="title">Seperation of Concern</span></h1>
<h2 class="author">E.S. Luper</h2>
<h2 class="date">2022/07/08</h2>
</div>

<main>
<h1 id="seperation-of-concerns">Seperation of Concerns</h1>
<p>Following up on dependency injection and the use of the repository structure, a core principle of these approaches is seperation of concern. In building an application, it is a good practice to seperate the concerns, tasks, functionalities, between different classes and components. Angular supports the practice of seperation of concern very well with its component system. Not utilized, one may end up with very large page components that try to handle everything. For maintainibility, and reuse of repeated features, it becomes clear that things should be broken down into smaller components. In web development, and very well in other fields of software development, testing is of large interest. Seperating tasks into specific components increases testability.</p>
<p>When first learning to build a controller in .Net, one handles database access via the controller. With the repository structure, the concern of database access is seperated from the controller. Likewise, the repository should only be dealing with direct domain objects, and DTO mapping will be handled by a seperate class.</p>
<h2 id="iuserrepo-and-its-implementation">IUserRepo and It&rsquo;s Implementation</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c#" data-lang="c#"><span style="display:flex;"><span><span style="color:#66d9ef">using</span> Microsoft.EntityFrameworkCore;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">using</span> CoYBackend.Models;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">namespace</span> CoYBackend.Services
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">IUserRepo</span>
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    Task&lt;User&gt; Get(<span style="color:#66d9ef">int</span> Id);
</span></span><span style="display:flex;"><span>    Task&lt;IEnumerable&lt;User&gt;&gt; GetAll();
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">UserRepo</span> : IUserRepo
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">readonly</span> CoYBackendContext _context;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> UserRepo(CoYBackendContext context)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      _context = context;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">async</span> Task&lt;IEnumerable&lt;User&gt;&gt; GetAll()
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">await</span> _context.users.ToListAsync();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="user-controller-with-endpoints">User Controller with Endpoints</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c#" data-lang="c#"><span style="display:flex;"><span><span style="color:#66d9ef">using</span> Microsoft.AspNetCore.Mvc;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">using</span> CoYBackend.Models;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">using</span> CoYBackend.Services;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">namespace</span> CoYBackend.Controllers
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">  [Route(&#34;api/[controller]</span><span style="color:#e6db74">&#34;)]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74"></span><span style="color:#a6e22e">  [ApiController]</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">UserController</span> : ControllerBase
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">readonly</span> ToDTO _toDTO;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">readonly</span> IUserRepo _userRepo;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> UserController(IUserRepo UserRepo)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      _userRepo = UserRepo;
</span></span><span style="display:flex;"><span>      _toDTO = <span style="color:#66d9ef">new</span> ToDTO();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">
</span></span></span><span style="display:flex;"><span><span style="color:#a6e22e">    [HttpGet]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">async</span> Task&lt;ActionResult&lt;IEnumerable&lt;UserDTO&gt;&gt;&gt; GetAll()
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">var</span> userList = <span style="color:#66d9ef">await</span> _userRepo.GetAll();
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">var</span> userDTOList = userList.Select(u =&gt; _toDTO.ToUserDTO(u)).ToList();
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> userDTOList;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="to-dto-mapping">To DTO Mapping</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c#" data-lang="c#"><span style="display:flex;"><span><span style="color:#66d9ef">using</span> CoYBackend.Models;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">namespace</span> CoYBackend.Services
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ToDTO</span>
</span></span><span style="display:flex;"><span>  {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">public</span> UserDTO ToUserDTO(User u)
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">var</span> userDTO = <span style="color:#66d9ef">new</span> UserDTO()
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        Id = u.Id,
</span></span><span style="display:flex;"><span>        Name = u.Name,
</span></span><span style="display:flex;"><span>        IsActive = u.IsActive
</span></span><span style="display:flex;"><span>      };
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> userDTO;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><br>
By seperating the DTO mapping into a class, it is made reusable and keeps mapping logic in one place. By pulling out the database context from the controller into a repository object, testing of the controller is made possible since a mock repository supplying mock domain objects can be injected into the controller in place of the real repository.</p>

</main>

  <footer>
  
  
  </footer>
  </body>
</html>

